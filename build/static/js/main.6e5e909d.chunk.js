(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{231:function(e,t,n){},243:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n(87),s=n.n(r),c=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,272)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,s=t.getLCP,c=t.getTTFB;n(e),a(e),r(e),s(e),c(e)}))},o=n(4),i=n(45),l=n(21),u=(n(230),n(231),n(260)),j=n(270),d=n(265),b=n(267),m=n(212),O=n(121),p=n.n(O),h=n(268),x=n(117),g=n(161),f=n(19),v=n(46),C=n(202),y={user:null};if(localStorage.getItem("AppJwtToken")){var I=Object(C.a)(localStorage.getItem("AppJwtToken"));1e3*I.exp<Date.now()?localStorage.removeItem("AppJwtToken"):y.user=I}var w=Object(a.createContext)({user:null,login:function(e){},logout:function(){}});function k(e,t){switch(t.type){case"LOGIN":return Object(v.a)(Object(v.a)({},e),{},{user:t.payload});case"LOGOUT":return Object(v.a)(Object(v.a)({},e),{},{user:null})}}function P(e){var t=Object(a.useReducer)(k,y),n=Object(f.a)(t,2),r=n[0],s=n[1];return Object(o.jsx)(w.Provider,Object(v.a)({value:{user:r.user,login:function(e){localStorage.setItem("AppJwtToken",e.token),s({type:"LOGIN",payload:e})},logout:function(){localStorage.removeItem("AppJwtToken"),s({type:"LOGOUT"})}}},e))}var S=n(32),$=n(20),A=n.n($),N=n(262);var L=function(e){var t=e.content,n=e.children;return Object(o.jsx)(N.a,{inverted:!0,content:t,trigger:n})};function D(){var e=Object(S.a)(["\n   mutation likePost($postId:String!){\n     likePost(postId:$postId){\n       id likes{\n         id username\n       }\n       likeCount\n     }\n   }\n"]);return D=function(){return e},e}var T=A()(D()),E=function(e){var t=e.post,n=t.id,r=t.likes,s=t.likeCount,c=Object(a.useContext)(w).user,l=Object(a.useState)(!1),j=Object(f.a)(l,2),d=j[0],b=j[1];Object(a.useEffect)((function(){c&&r.find((function(e){return e.username===c.username}))?b(!0):b(!1)}),[c,r]);var m=Object(u.useMutation)(T,{variables:{postId:n}}),O=Object(f.a)(m,1)[0],p=c?d?Object(o.jsx)(h.a,{color:"teal",children:Object(o.jsx)(x.a,{name:"heart"})}):Object(o.jsx)(h.a,{color:"teal",basic:!0,children:Object(o.jsx)(x.a,{name:"heart"})}):Object(o.jsx)(h.a,{color:"teal",as:i.b,basic:!0,children:Object(o.jsx)(x.a,{name:"heart"})});return Object(o.jsxs)(h.a,{as:"div",labelPosition:"right",onClick:O,children:[Object(o.jsx)(L,{content:d?"Unlike post":"Like post",children:p}),Object(o.jsx)(g.a,{as:"a",basic:!0,color:"teal",pointing:"left",children:s})]})},M=n(266);function Q(){var e=Object(S.a)(["\n{\n  getPosts {\n    id\n    username\n    createdAt\n    body\n    likeCount\n    commentCount\n    likes {\n      username\n    }\n    comments {\n      id\n      username\n      createdAt\n      body\n    }\n  }\n}\n"]);return Q=function(){return e},e}var R=A()(Q());function J(){var e=Object(S.a)(["\n  mutation deleteComment($postId: ID!, $commentId: ID!) {\n    deleteComment(postId: $postId, commentId: $commentId) {\n      id\n      comments {\n        id\n        username\n        createdAt\n        body\n      }\n      commentCount\n    }\n  }\n"]);return J=function(){return e},e}function U(){var e=Object(S.a)(["\n  mutation deletePost($postId: ID!) {\n    deletePost(postId: $postId)\n  }\n"]);return U=function(){return e},e}var F=A()(U()),q=A()(J()),z=function(e){var t=e.postId,n=e.commentId,r=e.callback,s=Object(a.useState)(!1),c=Object(f.a)(s,2),i=c[0],l=c[1],j=n?q:F,d=Object(u.useMutation)(j,{update:function(e){l(!1);var a=e.readQuery({query:R});void 0===a||n||(a.getPosts=a.getPosts.filter((function(e){return e.id.trim()!==t.trim()})),e.writeQuery({query:R,data:a}),r&&r())},onError:function(e){},variables:{postId:t,commentId:n}}),b=Object(f.a)(d,1)[0];return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(L,{content:n?"Delete this comment":"Delete this post",children:Object(o.jsx)(h.a,{color:"red",as:"div",onClick:function(){return l(!0)},floated:"right",children:Object(o.jsx)(x.a,{name:"trash",style:{margin:0}})})}),Object(o.jsx)(M.a,{open:i,onCancel:function(){return l(!1)},onConfirm:b})]})};var G=function(e){var t=e.post,n=t.body,r=t.createdAt,s=t.username,c=t.id,l=t.likes,u=t.likeCount,j=t.commentCount,d=Object(a.useContext)(w).user;return Object(o.jsxs)(b.a,{fluid:!0,children:[Object(o.jsxs)(b.a.Content,{children:[Object(o.jsx)(m.a,{floated:"right",size:"mini",src:"https://react.semantic-ui.com/images/avatar/large/molly.png"}),Object(o.jsx)(b.a.Header,{children:s}),Object(o.jsx)(b.a.Meta,{as:i.b,to:"/posts/".concat(c),children:p()(r).fromNow()}),Object(o.jsx)(b.a.Description,{children:n})]}),Object(o.jsxs)(b.a.Content,{extra:!0,children:[Object(o.jsx)(E,{post:{id:c,likes:l,likeCount:u}}),Object(o.jsx)(L,{content:"Comment on this post",children:Object(o.jsxs)(h.a,{labelPosition:"right",as:i.b,to:"/posts/".concat(c),children:[Object(o.jsx)(h.a,{color:"teal",basic:!0,children:Object(o.jsx)(x.a,{name:"comments"})}),Object(o.jsx)(g.a,{basic:!0,color:"blue",pointing:"left",children:j})]})}),d.username===s&&Object(o.jsx)(z,{postId:c})]})]})},H=n(214),B=n(263),V=n(136),K=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(a.useState)(t),r=Object(f.a)(n,2),s=r[0],c=r[1],o=function(e){c(Object(v.a)(Object(v.a)({},s),{},Object(V.a)({},e.target.name,e.target.value)))},i=function(t){t.preventDefault(),e()};return{onChange:o,onSubmit:i,values:s}};function W(){var e=Object(S.a)(["\n  mutation createPost($body: String!) {\n    createPost(body: $body) {\n      id\n      body\n      username\n      createdAt\n      likes {\n        id\n        username\n      }\n      likeCount\n      comments {\n        id\n        username\n        body\n        createdAt\n      }\n      commentCount\n    }\n  }\n"]);return W=function(){return e},e}var X=A()(W()),Y=function(){var e=K((function(){c()}),{body:""}),t=e.values,n=e.onSubmit,a=e.onChange,r=Object(u.useMutation)(X,{variables:t,update:function(e,n){var a=e.readQuery({query:R});console.log("Hello there",a),void 0!==a&&(a.getPosts=[n.data.createPost].concat(Object(H.a)(a.getPosts)),e.writeQuery({query:R,data:a}),t.body="")},onError:function(e){}}),s=Object(f.a)(r,2),c=s[0],i=s[1].error;return Object(o.jsxs)("div",{children:[Object(o.jsxs)(B.a,{onSubmit:n,children:[Object(o.jsx)("h2",{children:"Create a post"}),Object(o.jsxs)(B.a.Field,{children:[Object(o.jsx)(B.a.TextArea,{placeholder:"Hi Learners",name:"body",type:"textarea",onChange:a,error:!!i,value:t.body}),Object(o.jsx)(h.a,{type:"submit",color:"teal",children:"submit"})]})]}),i&&Object(o.jsx)("div",{className:"ui error message",children:Object(o.jsx)("ul",{className:"list",children:Object(o.jsx)("li",{children:i.graphQLErrors[0].message})})})]})};var Z=function(){var e=Object(u.useQuery)(R),t=e.loading,n=e.data,r=Object(a.useContext)(w).user;return Object(o.jsxs)(j.a,{divided:!0,children:[Object(o.jsx)(j.a.Row,{className:"page-title",children:Object(o.jsx)("h1",{children:"Recent Posts"})}),Object(o.jsx)(j.a.Row,{children:r&&Object(o.jsx)(j.a.Column,{children:Object(o.jsx)(Y,{})})}),Object(o.jsx)(j.a.Row,{children:t?Object(o.jsx)("h1",{className:"loading",children:"..loading posts.."}):Object(o.jsx)(d.a.Group,{children:n&&n.getPosts.map((function(e){return Object(o.jsx)(j.a.Column,{mobile:16,tablet:8,computer:8,style:{marginTop:15,alignItems:"center"},children:Object(o.jsx)(G,{post:e})},e.id)}))})})]})};function _(){var e=Object(S.a)(["\n  mutation register(\n    $username: String!\n    $email: String!\n    $password: String!\n    $confirmPassword: String!\n  ) {\n    register(\n      registerInput: {\n        username: $username\n        email: $email\n        password: $password\n        confirmPassword: $confirmPassword\n      }\n    ) {\n      id\n      email\n      username\n      token\n      createdAt\n    }\n  }\n"]);return _=function(){return e},e}var ee=A()(_()),te=function(e){var t=Object(a.useContext)(w),n=Object(a.useState)({}),r=Object(f.a)(n,2),s=r[0],c=r[1],i=K((function(){O()}),{username:"",email:"",password:"",confirmPassword:""}),l=i.onChange,j=i.onSubmit,d=i.values,b=Object(u.useMutation)(ee,{update:function(e,n){var a=n.data.register;t.login(a)},onError:function(e){c(e.graphQLErrors[0].extensions.exception.errors)},variables:d}),m=Object(f.a)(b,2),O=m[0],p=m[1].loading;return Object(o.jsxs)("div",{className:"form-container",children:[Object(o.jsxs)(B.a,{onSubmit:j,noValidate:!0,className:p?"loading":"",children:[Object(o.jsx)("h1",{children:"Register"}),Object(o.jsx)(B.a.Input,{label:"Username",type:"text",placeholder:"Username..",name:"username",error:!!s.username,value:d.username,onChange:l}),Object(o.jsx)(B.a.Input,{label:"Email",type:"email",placeholder:"Email..",name:"email",error:!!s.email,value:d.email,onChange:l}),Object(o.jsx)(B.a.Input,{label:"Password",type:"password",placeholder:"Password..",name:"password",error:!!s.password,value:d.password,onChange:l}),Object(o.jsx)(B.a.Input,{label:"Confirm Password",type:"password",placeholder:"Confirm Password..",name:"confirmPassword",error:!!s.confirmPassword,value:d.confirmPassword,onChange:l}),Object(o.jsx)(h.a,{type:"submit",primary:!0,children:"Register"})]}),Object.keys(s).length>0&&Object(o.jsx)("div",{className:"ui error message",children:Object(o.jsx)("ul",{className:"list",children:Object.values(s).map((function(e){return Object(o.jsx)("li",{children:e},e)}))})})]})};function ne(){var e=Object(S.a)(["\n  mutation login(\n    $username: String!\n    $password: String!\n  ) {\n    login( username: $username\n        password: $password\n    ) {\n      id\n      email\n      username\n      token\n      createdAt\n    }\n  }\n"]);return ne=function(){return e},e}var ae=A()(ne()),re=function(e){var t=Object(a.useContext)(w),n=Object(a.useState)({}),r=Object(f.a)(n,2),s=r[0],c=r[1],i=K((function(){O()}),{username:"",password:""}),l=i.onChange,j=i.onSubmit,d=i.values,b=Object(u.useMutation)(ae,{update:function(n,a){var r=a.data.login;t.login(r),e.history.push("/")},onError:function(e){c(e.graphQLErrors[0].extensions.exception.errors)},variables:d}),m=Object(f.a)(b,2),O=m[0],p=m[1].loading;return Object(o.jsxs)("div",{className:"form-container",children:[Object(o.jsxs)(B.a,{onSubmit:j,noValidate:!0,className:p?"loading":"",children:[Object(o.jsx)("h1",{children:"Login"}),Object(o.jsx)(B.a.Input,{label:"Username",type:"text",placeholder:"Username..",name:"username",error:!!s.username,value:d.username,onChange:l}),Object(o.jsx)(B.a.Input,{label:"Password",type:"password",placeholder:"Password..",name:"password",error:!!s.password,value:d.password,onChange:l}),Object(o.jsx)(h.a,{type:"submit",primary:!0,children:"login"})]}),Object.keys(s).length>0&&Object(o.jsx)("div",{className:"ui error message",children:Object(o.jsx)("ul",{className:"list",children:Object.values(s).map((function(e){return Object(o.jsx)("li",{children:e},e)}))})})]})},se=n(264);var ce=function(){var e=Object(a.useContext)(w),t=e.user,n=e.logout,r=window.location.pathname,s="/"===r?"home":r.substr(1),c=Object(a.useState)(s),l=Object(f.a)(c,2),u=l[0],j=l[1],d=function(e,t){var n=t.name;return j(n)};return t?Object(o.jsxs)(se.a,{pointing:!0,secondary:!0,size:"massive",color:"teal",children:[Object(o.jsx)(se.a.Item,{name:t.username,active:!0,as:i.b,to:"/"}),Object(o.jsx)(se.a.Menu,{position:"right",children:Object(o.jsx)(se.a.Item,{name:"logout",onClick:n})})]}):Object(o.jsxs)(se.a,{pointing:!0,secondary:!0,size:"massive",color:"teal",children:[Object(o.jsx)(se.a.Item,{name:"home",active:"home"===u,onClick:d,as:i.b,to:"/"}),Object(o.jsx)(se.a.Item,{name:"login",active:"login"===u,onClick:d,as:i.b,to:"/login"}),Object(o.jsx)(se.a.Menu,{position:"right",children:Object(o.jsx)(se.a.Item,{name:"register",active:"register"===u,onClick:d,as:i.b,to:"/register"})})]})},oe=n(261),ie=n(216);var le=function(e){var t=e.component,n=Object(ie.a)(e,["component"]),r=Object(a.useContext)(w);return Object(o.jsx)(l.b,Object(v.a)(Object(v.a)({},n),{},{render:function(e){return r.user?Object(o.jsx)(l.a,{to:"/"}):Object(o.jsx)(t,Object(v.a)({},e))}}))};function ue(){var e=Object(S.a)(["\n  query($postId: ID!) {\n    getPost(postId: $postId) {\n      id\n      body\n      createdAt\n      username\n      likeCount\n      likes {\n        username\n      }\n      commentCount\n      comments {\n        id\n        username\n        createdAt\n        body\n      }\n    }\n  }\n"]);return ue=function(){return e},e}function je(){var e=Object(S.a)(["\n  mutation($postId: String!, $body: String!) {\n    createComment(postId: $postId, body: $body) {\n      id\n      comments {\n        id\n        username\n        createdAt\n        body\n      }\n      commentCount\n    }\n  }\n"]);return je=function(){return e},e}var de=A()(je()),be=A()(ue()),me=function(e){var t,n=e.match.params.postId,r=Object(a.useContext)(w).user,s=Object(u.useQuery)(be,{variables:{postId:n}}).data,c=Object(a.useState)(""),i=Object(f.a)(c,2),l=i[0],d=i[1],O=Object(a.useRef)(null),v=Object(u.useMutation)(de,{update:function(e,t){d(""),O.current.blur()},variables:{postId:n,body:l}}),C=Object(f.a)(v,1)[0];if(s){var y=s.getPost,I=y.id,k=y.body,P=y.createdAt,S=y.username,$=y.comments,A=y.likes,N=y.likeCount,D=y.commentCount;t=Object(o.jsx)(j.a,{children:Object(o.jsxs)(j.a.Row,{children:[Object(o.jsx)(j.a.Column,{width:2,children:Object(o.jsx)(m.a,{floated:"right",size:"small",src:"https://react.semantic-ui.com/images/avatar/large/molly.png"})}),Object(o.jsxs)(j.a.Column,{width:14,children:[Object(o.jsxs)(b.a,{fluid:!0,children:[Object(o.jsxs)(b.a.Content,{children:[Object(o.jsx)(b.a.Header,{children:S}),Object(o.jsx)(b.a.Meta,{children:p()(P).fromNow()}),Object(o.jsx)(b.a.Description,{children:k})]}),Object(o.jsx)("hr",{}),Object(o.jsxs)(b.a.Content,{extra:!0,children:[Object(o.jsx)(E,{user:r,post:{id:I,likeCount:N,likes:A}}),Object(o.jsx)(L,{content:"Comment on post",children:Object(o.jsxs)(h.a,{as:"div",labelPosition:"right",onClick:function(){return console.log("comment on this post")},children:[Object(o.jsx)(h.a,{basic:!0,color:"blue",children:Object(o.jsx)(x.a,{name:"comments"})}),Object(o.jsx)(g.a,{basic:!0,color:"blue",pointing:"left",children:D})]})}),r&&r.username===S&&Object(o.jsx)(z,{postId:I,callback:function(t){e.history.push("/")}})]})]}),r&&Object(o.jsx)(b.a,{fluid:!0,children:Object(o.jsxs)(b.a.Content,{children:[Object(o.jsx)("p",{children:"Post a comment"}),Object(o.jsx)(B.a,{children:Object(o.jsxs)("div",{className:"ui action input fluid",children:[Object(o.jsx)("input",{type:"text",placeholder:"Comment..",onChange:function(e){return d(e.target.value)},value:l,name:"comment",ref:O}),Object(o.jsxs)("button",{type:"submit",className:"ui button teal",disabled:""===l.trim(),onClick:C,children:[" ","submit"]})]})})]})}),$.map((function(e){return Object(o.jsx)(b.a,{fluid:!0,children:Object(o.jsxs)(b.a.Content,{children:[r&&r.username===e.username&&Object(o.jsx)(z,{postId:I,commentId:e.id}),Object(o.jsx)(b.a.Header,{children:e.username}),Object(o.jsx)(b.a.Meta,{children:p()(e.createdAt).fromNow()}),Object(o.jsx)(b.a.Description,{children:e.body})]})},e.id)}))]})]})})}else t=Object(o.jsx)("p",{children:"Loading post...."});return t};var Oe=function(){return Object(o.jsx)(P,{children:Object(o.jsx)(i.a,{children:Object(o.jsxs)(oe.a,{children:[Object(o.jsx)(ce,{}),Object(o.jsx)(l.b,{exact:!0,path:"/",component:Z}),Object(o.jsx)(le,{exact:!0,path:"/login",component:re}),Object(o.jsx)(le,{exact:!0,path:"/register",component:te}),Object(o.jsx)(l.b,{exact:!0,path:"/posts/:postId",component:me})]})})})},pe=n(209),he=n(213),xe=n(215),ge=n(208),fe=Object(xe.a)({uri:"https://fast-caverns-41450.herokuapp.com"}),ve=Object(ge.a)((function(){var e=localStorage.getItem("AppJwtToken");return{headers:{Authorization:e?"Bearer ".concat(e):""}}})),Ce=new pe.a({link:ve.concat(fe),cache:new he.a}),ye=Object(o.jsx)(u.ApolloProvider,{client:Ce,children:Object(o.jsx)(Oe,{})});s.a.render(ye,document.getElementById("root")),c()}},[[243,1,2]]]);
//# sourceMappingURL=main.6e5e909d.chunk.js.map